<!DOCTYPE html>
<html>
  <title>W3.CSS Template</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../w3.css">
  <link rel="stylesheet" href="../w3-theme-black.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
  <body>
    <!-- Header -->
    <header class="w3-container w3-theme w3-padding" id="myHeader">
      
      <br>
      <div class="w3-center">
        <h4>BEAUTIFUL RESPONSIVE WEB SITES</h4>
        <h1 class="w3-xxxlarge">BUILT WITH W3.CSS</h1>
      </div>
    </header>
    <div class="w3-row-padding w3-center w3-margin-top">
      <div class="w3-half">
        <div class = "w3-card w3-container">
          <h4>Existing Sourced Playlists</h4>
          
          <ul id="drainList" class="w3-ul">
          </ul>
          <button class = "w3-btn w3-blue" onclick="getDrainlists()"> click here
          </button>
          <p></p>
          
        </div>
        
        
      </div>
      <div class = "w3-half">
        <div class = "w3-card w3-container">
          <h4>Selected Sourced Playlist Structure</h4>
          <p>
            TEXT2
          </p>
          
        </div>
      </div>
    </div>
    <br>
    <!-- Footer -->
    <footer class="w3-container w3-theme-dark w3-padding-16 ">
      <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
      <p>Check out my  <a href="w3css_references.asp" class="w3-btn w3-theme-light" target="_blank">Github</a></p>
    </footer>
  </body>
  <script type="text/javascript">
  var nameToUri
  function getDrainlists(){
  user = "Danny"
  var url= "http://127.0.0.1:5000/list_drains"
  url = url + "?user=" + user
  var rule = "onclick=\"this.style.color = this.style.color == \'red\' ? \'black\' : \'red\'\" style=\"cursor: pointer\""
  // todo update to actually send the request, you fool!
  var xmlhttp = new XMLHttpRequest();
  
  xmlhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
  plists = JSON.parse(xmlhttp.responseText)
  console.log(plists)
  document.getElementById('drainList').innerHTML = ""
  for (let i = 0; i < plists.length; i++) {
  document.getElementById('drainList').innerHTML += ('<li ' + rule +  '>' + plists[i]["Name"] + '</li>');
  }
  
  }
  };
  xmlhttp.open("GET", url, true);
  xmlhttp.send();
  }
  function listToMap(lst){
  m = new Map()
  for (var i = 0; i < lst.length; i++) {
  m[lst[i]["name"]] = lst[i]["uri"]
  }
  return m
  }
  function search(searchString){
  // todo this is garbage, but makes it look decent
  window.scrollTo(0,146)
  searchString = searchString.toUpperCase()
  var ul = document.getElementById("theList");
  var li = ul.getElementsByTagName("li");
  
  for (var i = 0; i < li.length; i++) {
  if (li[i].textContent.toUpperCase().includes(searchString)){
  li[i].style.display = "";
  }
  else {
  li[i].style.display = "none";
  }
  }
  }
  function collectHighlighted(){
  var arr = []
  var ul = document.getElementById("theList");
  var li = ul.getElementsByTagName("li");
  
  for (var i = 0; i < li.length; i++) {
  if (li[i].style.color === "red"){
  arr.push(nameToUri[li[i].textContent])
  }
  
  }
  var name = document.getElementById("sourcedName").value
  console.log(arr)
  console.log(name)
  for (var i = 0; i < li.length; i++) {
  li[i].style.color = "black"
  }
  document.getElementById("sourcedName").value = ""
  createNewDrain(name, arr)
  }
  function createNewDrain(name, sources){
  user = "Danny"
  var url= "http://127.0.0.1:5000/new_drain"
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.open("POST", url, true);
  xmlhttp.setRequestHeader('Content-Type', 'application/json');
  xmlhttp.send(JSON.stringify({"user": user, "drainlist":name, "sources":sources}));
  // xmlhttp.send();
  }
  </script>
</html>